:80 {
  encode zstd gzip
  root * /var/www/html
  file_server

  @api path /api/*
  reverse_proxy @api 127.0.0.1:5055

  # Handle SPA routing - serve index.html for all non-API routes
  @spa {
    path /api/*
    not path /api/*
  }
  try_files {path} /index.html

  # Security headers
  header {
    X-Frame-Options "SAMEORIGIN"
    X-Content-Type-Options "nosniff"
    X-XSS-Protection "1; mode=block"
    Referrer-Policy "strict-origin-when-cross-origin"
  }

  # Cache static assets
  @static {
    path *.js *.css *.png *.jpg *.jpeg *.gif *.ico *.svg *.woff *.woff2
  }
  header @static Cache-Control "public, max-age=31536000"

  # Logging
  log {
    output file /var/log/caddy/kiosk.log {
      roll_size 10MB
      roll_keep 5
      roll_keep_for 720h
    }
    format console
  }
}
